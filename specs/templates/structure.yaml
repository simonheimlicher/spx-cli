# specs/templates/structure.yaml
#
# Machine-readable structure definition for the specs/ directory.
# The spx CLI uses this to parse and validate work items.
#
# See README.md for rationale and parsing guide.

# ------------------------------------------------------------------------------
# NAMING PATTERNS
# ------------------------------------------------------------------------------
# Three pattern types:
#   name: "exact"           - Exact string match
#   pattern: "{var}_{var}"  - Variable substitution, then match
#   glob: "*.test.ts"       - Filesystem glob

patterns:
  work_item:
    directory:
      pattern: "{level}-{bsp}_{slug}"
      # Examples: capability-21_core-cli, feature-48_test-harness, story-21_context-manager
    definition:
      pattern: "{slug}.{level}.md"
      # Examples: core-cli.capability.md, test-harness.feature.md, context-manager.story.md

  decision:
    directory:
      name: "decisions"
    file:
      pattern: "adr-{nnn}_{slug}.md"
      # Example: adr-001_cli-framework.md

  tests:
    directory:
      name: "tests"
    done_marker:
      name: "DONE.md"
    progress:
      glob: "*.test.ts"

  catalyst:
# Pattern varies by level - see levels section
# capability: *.prd.md (Product Requirements)
# feature: *.trd.md (Technical Requirements)

# ------------------------------------------------------------------------------
# ROOTS
# ------------------------------------------------------------------------------
# Work items live under these directories (directly under specs/)

roots:
  - doing # Active work
  - backlog # Future work
  - archive # Completed work

# ------------------------------------------------------------------------------
# PROJECT-LEVEL
# ------------------------------------------------------------------------------
# These exist at specs/ level, not inside work items

project:
  templates: "templates/" # specs/templates/ (this directory)

# ------------------------------------------------------------------------------
# BSP NUMBERING
# ------------------------------------------------------------------------------
# Binary Space Partitioning for work item ordering

bsp:
  range: [10, 99] # Two-digit numbers
  ordering: dependency # Lower number = must complete first
# BSP 21 blocks BSP 32 blocks BSP 43...

# ------------------------------------------------------------------------------
# STATUS RULES
# ------------------------------------------------------------------------------
# How to determine work item status from tests/ directory

status:
  OPEN:
    condition: tests_absent_or_empty
    description: "tests/ missing OR contains no files"
  IN_PROGRESS:
    condition: tests_has_files_no_done_md
    description: "tests/ has *.test.ts but no DONE.md"
  DONE:
    condition: done_md_exists
    description: "tests/DONE.md exists"

# ------------------------------------------------------------------------------
# WORK ITEM LEVELS
# ------------------------------------------------------------------------------
# Ordered from root to leaf. Each level contains children of the next.
# The last level is a leaf (no children).

levels:
  - name: capability
    catalyst:
      glob: "*.prd.md"
    decisions: true
    tests:
      type: e2e
      graduate_to: "tests/e2e/"

  - name: feature
    catalyst:
      glob: "*.trd.md"
    decisions: true
    tests:
      type: integration
      graduate_to: "tests/integration/"

  - name: story
    # No catalyst (stories are atomic implementation units)
    # No decisions (inherits from parent feature/capability)
    decisions: false
    tests:
      type: unit
      graduate_to: "tests/unit/"
